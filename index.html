<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ULTIMATE PASS & PANIC</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="theme-color" content="#ff0033">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
button, input, select { touch-action: manipulation; cursor: pointer; font-family: inherit; }
button:focus, input:focus { outline: none; }

:root {
    /* Default Theme - Neon */
    --primary: #ff0033;
    --secondary: #00ff88;
    --accent: #0088ff;
    --warning: #ffcc00;
    --danger: #aa00ff;
    --dark: #0a0a0a;
    --darker: #050505;
    --light: #fff;
    --gray: #aaa;
    --card-bg: rgba(20, 20, 30, 0.85);
    --nav-bg: rgba(15, 15, 25, 0.95);
    --glow: 0 0 20px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

body {
    font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--darker);
    color: var(--light);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
    -webkit-tap-highlight-color: transparent;
}

/* ---------- THEME VARIABLES ---------- */
.theme-dark {
    --primary: #3498db;
    --secondary: #2ecc71;
    --accent: #9b59b6;
    --warning: #f1c40f;
    --danger: #e74c3c;
    --dark: #1a1a2e;
    --darker: #16213e;
    --light: #ecf0f1;
    --gray: #bdc3c7;
    --card-bg: rgba(30, 30, 46, 0.9);
    --nav-bg: rgba(22, 33, 62, 0.95);
}

.theme-party {
    --primary: #ff0066;
    --secondary: #00ffcc;
    --accent: #ffcc00;
    --warning: #ff6600;
    --danger: #cc00ff;
    --dark: #110022;
    --darker: #220033;
    --light: #ffffff;
    --gray: #ff99cc;
    --card-bg: rgba(40, 0, 60, 0.85);
    --nav-bg: rgba(60, 0, 80, 0.95);
}

.theme-horror {
    --primary: #ff3300;
    --secondary: #33ff00;
    --accent: #ff9900;
    --warning: #ff0033;
    --danger: #660000;
    --dark: #0a0a0a;
    --darker: #050505;
    --light: #f0f0f0;
    --gray: #666666;
    --card-bg: rgba(30, 0, 0, 0.9);
    --nav-bg: rgba(20, 0, 0, 0.95);
}

/* ---------- BACKGROUND & PARTICLES ---------- */
.background-animation {
    position: fixed;
    inset: 0;
    z-index: -2;
    opacity: 0.7;
    transition: var(--transition);
}

.particles-container {
    position: fixed;
    inset: 0;
    z-index: -1;
    overflow: hidden;
}

.particle {
    position: absolute;
    border-radius: 50%;
    background: var(--primary);
    opacity: 0.3;
    animation: float 15s infinite linear;
    filter: blur(1px);
}

@keyframes float {
    0% { transform: translateY(100vh) translateX(0) rotate(0deg); opacity: 0; }
    10% { opacity: 0.7; }
    90% { opacity: 0.7; }
    100% { transform: translateY(-100px) translateX(100px) rotate(360deg); opacity: 0; }
}

/* ---------- NAVIGATION BAR ---------- */
.nav-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: var(--nav-bg);
    backdrop-filter: blur(20px);
    z-index: 1000;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 -5px 25px rgba(0, 0, 0, 0.3);
    padding: 10px 0;
    display: flex;
    justify-content: space-around;
    align-items: center;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
    border-radius: 15px;
    color: var(--gray);
    transition: var(--transition);
    flex: 1;
    max-width: 80px;
    text-decoration: none;
    border: none;
    background: transparent;
}

.nav-item i {
    font-size: 1.5rem;
    margin-bottom: 5px;
}

.nav-item span {
    font-size: 0.75rem;
    font-weight: 600;
}

.nav-item.active {
    color: var(--primary);
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-5px);
}

.nav-item:hover {
    color: var(--light);
    background: rgba(255, 255, 255, 0.05);
}

/* ---------- TOP HEADER ---------- */
.game-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: 15px;
    background: var(--nav-bg);
    backdrop-filter: blur(20px);
    z-index: 1000;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-left, .header-right {
    display: flex;
    align-items: center;
    gap: 10px;
}

.header-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--primary);
    text-shadow: 0 0 10px var(--primary);
}

/* ---------- SCREENS ---------- */
.screen {
    display: none;
    min-height: 100vh;
    padding: 80px 20px 80px;
    justify-content: flex-start;
    align-items: center;
    flex-direction: column;
    text-align: center;
    animation: fadeIn 0.4s ease;
    overflow-y: auto;
    width: 100%;
}

.screen.active { 
    display: flex; 
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ---------- BUTTONS ---------- */
.btn {
    width: 100%;
    max-width: 300px;
    padding: 18px 25px;
    border: none;
    border-radius: 15px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    margin: 10px 0;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    letter-spacing: 0.5px;
}

.btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
}

.btn:active {
    transform: translateY(-1px);
}

.btn::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.7s;
}

.btn:hover::after {
    left: 100%;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary), color-mix(in srgb, var(--primary) 70%, white));
    color: var(--light);
    box-shadow: 0 5px 20px color-mix(in srgb, var(--primary) 40%, transparent);
}

.btn-info {
    background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent) 70%, white));
    color: var(--light);
    box-shadow: 0 5px 20px color-mix(in srgb, var(--accent) 40%, transparent);
}

.btn-success {
    background: linear-gradient(135deg, var(--secondary), color-mix(in srgb, var(--secondary) 70%, white));
    color: var(--darker);
    box-shadow: 0 5px 20px color-mix(in srgb, var(--secondary) 40%, transparent);
}

.btn-warning {
    background: linear-gradient(135deg, var(--warning), color-mix(in srgb, var(--warning) 70%, white));
    color: var(--darker);
    box-shadow: 0 5px 20px color-mix(in srgb, var(--warning) 40%, transparent);
}

.btn-danger {
    background: linear-gradient(135deg, var(--danger), color-mix(in srgb, var(--danger) 70%, white));
    color: var(--light);
    box-shadow: 0 5px 20px color-mix(in srgb, var(--danger) 40%, transparent);
}

/* ---------- HOME SCREEN ---------- */
.logo {
    font-size: 3rem;
    margin: 30px 0 20px;
    color: transparent;
    background: linear-gradient(45deg, var(--primary), var(--warning), var(--secondary), var(--accent), var(--danger));
    -webkit-background-clip: text;
    background-clip: text;
    text-shadow: 0 0 30px color-mix(in srgb, var(--primary) 30%, transparent);
    font-weight: 900;
    letter-spacing: 1px;
    animation: pulse 2s infinite alternate;
}

@keyframes pulse {
    0% { transform: scale(1); }
    100% { transform: scale(1.05); }
}

.tagline {
    font-size: 1.1rem;
    color: var(--gray);
    margin: 0 15px 40px;
    max-width: 500px;
    line-height: 1.6;
}

.quick-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 30px 0;
    width: 100%;
    max-width: 500px;
}

.stat-card {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 15px;
    border-left: 4px solid var(--primary);
    text-align: left;
    transition: var(--transition);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.stat-card h3 {
    font-size: 0.9rem;
    color: var(--gray);
    margin-bottom: 8px;
}

.stat-card .value {
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary);
}

/* ---------- SETUP SCREEN ---------- */
.setup-container {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 20px;
    max-width: 500px;
    width: 100%;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
}

.setup-section {
    margin-bottom: 30px;
    text-align: left;
}

.setup-section h2 {
    color: var(--primary);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Game Mode Selector */
.game-mode-selector {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 20px 0;
}

.mode-btn {
    padding: 20px 15px;
    border-radius: 15px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.3);
    color: var(--light);
    font-weight: bold;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    font-size: 0.9rem;
}

.mode-btn i {
    font-size: 1.5rem;
}

.mode-btn.active {
    border-color: var(--primary);
    background: color-mix(in srgb, var(--primary) 20%, transparent);
    box-shadow: 0 0 20px color-mix(in srgb, var(--primary) 40%, transparent);
    transform: translateY(-5px);
}

/* Theme Selector */
.theme-selector {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin: 20px 0;
}

.theme-btn {
    padding: 15px 10px;
    border-radius: 12px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.3);
    color: var(--light);
    font-size: 0.8rem;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.theme-btn i {
    font-size: 1.2rem;
}

.theme-btn.active {
    border-color: var(--primary);
    background: color-mix(in srgb, var(--primary) 20%, transparent);
    box-shadow: 0 0 15px color-mix(in srgb, var(--primary) 40%, transparent);
    transform: scale(1.05);
}

/* Player Input */
.player-input-group {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.player-input-group input {
    flex: 1;
    padding: 18px 20px;
    border-radius: 15px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.3);
    color: var(--light);
    font-size: 1rem;
    transition: var(--transition);
}

.player-input-group input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 20px color-mix(in srgb, var(--accent) 40%, transparent);
}

.players-list-container {
    width: 100%;
    margin-top: 25px;
    max-height: 250px;
    overflow-y: auto;
    border-radius: 15px;
    background: rgba(0, 0, 0, 0.2);
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.players-list {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
    min-height: 60px;
}

.player-tag {
    display: flex;
    gap: 10px;
    align-items: center;
    padding: 12px 20px;
    border-radius: 50px;
    background: linear-gradient(135deg, 
        color-mix(in srgb, var(--accent) 20%, transparent), 
        color-mix(in srgb, var(--danger) 20%, transparent));
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: var(--transition);
    animation: slideIn 0.3s ease;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.player-tag:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

.player-tag span {
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    font-weight: 600;
}

.remove-player {
    background: color-mix(in srgb, var(--primary) 20%, transparent);
    color: var(--primary);
    border: none;
    width: 26px;
    height: 26px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: var(--transition);
}

.remove-player:hover {
    background: color-mix(in srgb, var(--primary) 40%, transparent);
    transform: rotate(90deg);
}

.player-count {
    margin-top: 15px;
    color: var(--gray);
    font-size: 0.9rem;
    display: flex;
    justify-content: space-between;
    padding: 0 5px;
}

.player-count.warning {
    color: var(--primary);
    font-weight: bold;
}

/* ---------- GAME SCREENS ---------- */
.panic-container, .stop-container, .result-container {
    background: var(--card-bg);
    padding: 30px;
    border-radius: 25px;
    max-width: 500px;
    width: 100%;
    border: 2px solid var(--primary);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(20px);
    animation: containerGlow 3s infinite alternate;
}

@keyframes containerGlow {
    0% { box-shadow: 0 0 40px color-mix(in srgb, var(--primary) 30%, transparent); }
    100% { box-shadow: 0 0 60px color-mix(in srgb, var(--primary) 50%, transparent); }
}

.panic-title {
    font-size: 2.8rem;
    color: var(--primary);
    margin-bottom: 25px;
    text-shadow: 0 0 25px var(--primary);
    animation: shake 0.8s infinite alternate;
}

@keyframes shake {
    0% { transform: translateX(-3px) rotate(-1deg); }
    100% { transform: translateX(3px) rotate(1deg); }
}

.current-player-display {
    padding: 25px;
    border-radius: 20px;
    border: 2px solid var(--primary);
    background: color-mix(in srgb, var(--primary) 10%, transparent);
    margin: 25px 0;
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--light);
    text-shadow: 0 0 15px var(--light);
    animation: pulse 1.5s infinite;
}

.panic-timer {
    font-size: 6rem;
    color: var(--primary);
    margin: 30px 0;
    font-weight: 900;
    text-shadow: 0 0 40px var(--primary);
    font-family: 'Courier New', monospace;
    animation: timerPulse 1s infinite;
}

@keyframes timerPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.progress-container {
    width: 100%;
    margin: 30px 0;
}

.progress-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    font-size: 1rem;
    color: var(--gray);
}

.progress-bar {
    width: 100%;
    height: 15px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--warning), var(--secondary));
    border-radius: 10px;
    width: 100%;
    transition: width 0.1s linear;
}

.stop-title {
    font-size: 4.5rem;
    color: var(--secondary);
    margin-bottom: 25px;
    text-shadow: 0 0 30px var(--secondary);
    animation: bounce 0.8s infinite alternate;
}

@keyframes bounce {
    0% { transform: translateY(0); }
    100% { transform: translateY(-10px); }
}

.caught-player {
    margin: 30px 0;
    padding: 30px;
    border-radius: 20px;
    border: 2px solid var(--secondary);
    background: color-mix(in srgb, var(--secondary) 10%, transparent);
    font-size: 2rem;
    font-weight: bold;
}

.caught-player span {
    color: var(--secondary);
    text-shadow: 0 0 15px var(--secondary);
}

.challenge-selector {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-top: 35px;
    width: 100%;
}

.btn-challenge {
    padding: 30px 20px;
    font-size: 1.5rem;
    border-radius: 20px;
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid #444;
    color: var(--light);
    transition: var(--transition);
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
}

.btn-challenge:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
}

.btn-challenge.truth {
    border-color: var(--accent);
    background: linear-gradient(135deg, 
        color-mix(in srgb, var(--accent) 20%, transparent), 
        color-mix(in srgb, var(--accent) 40%, transparent));
}

.btn-challenge.dare {
    border-color: var(--primary);
    background: linear-gradient(135deg, 
        color-mix(in srgb, var(--primary) 20%, transparent), 
        color-mix(in srgb, var(--primary) 40%, transparent));
}

.btn-challenge.random {
    border-color: var(--danger);
    background: linear-gradient(135deg, 
        color-mix(in srgb, var(--danger) 20%, transparent), 
        color-mix(in srgb, var(--danger) 40%, transparent));
}

/* ---------- RESULT SCREEN ---------- */
.challenge-type {
    display: inline-block;
    padding: 12px 25px;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: bold;
    margin-bottom: 20px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.challenge-type.truth {
    background: color-mix(in srgb, var(--accent) 20%, transparent);
    color: var(--accent);
    border: 2px solid var(--accent);
}

.challenge-type.dare {
    background: color-mix(in srgb, var(--primary) 20%, transparent);
    color: var(--primary);
    border: 2px solid var(--primary);
}

.challenge-type.random {
    background: color-mix(in srgb, var(--danger) 20%, transparent);
    color: var(--danger);
    border: 2px solid var(--danger);
}

.challenge-text {
    font-size: 2rem;
    margin: 40px 0;
    padding: 30px;
    border-radius: 20px;
    background: color-mix(in srgb, var(--card-bg) 80%, black);
    border: 3px dashed rgba(255, 255, 255, 0.2);
    min-height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1.5;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
}

.excuse-text {
    font-size: 1.3rem;
    margin: 25px 0;
    color: var(--gray);
    font-style: italic;
    padding: 15px;
    border-radius: 15px;
    background: rgba(0, 0, 0, 0.2);
}

/* ---------- SCOREBOARD ---------- */
.scoreboard-container {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 25px;
    max-width: 600px;
    width: 100%;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(20px);
    max-height: 70vh;
    overflow-y: auto;
}

.scoreboard-title {
    font-size: 2.8rem;
    color: var(--warning);
    margin-bottom: 25px;
    text-shadow: 0 0 25px var(--warning);
}

.scoreboard-table {
    width: 100%;
    border-collapse: collapse;
    margin: 25px 0;
}

.scoreboard-table th {
    padding: 20px 15px;
    background: color-mix(in srgb, var(--warning) 10%, transparent);
    color: var(--warning);
    text-align: left;
    border-bottom: 3px solid rgba(255, 255, 255, 0.2);
    font-size: 1.1rem;
}

.scoreboard-table td {
    padding: 18px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: var(--transition);
}

.scoreboard-table tr:hover td {
    background: rgba(255, 255, 255, 0.05);
    transform: translateX(5px);
}

.scoreboard-table .rank {
    font-weight: bold;
    color: var(--warning);
    width: 60px;
    text-align: center;
    font-size: 1.2rem;
}

.scoreboard-table .player-name {
    font-weight: 600;
    font-size: 1.1rem;
}

.scoreboard-table .score {
    text-align: right;
    font-weight: bold;
    font-size: 1.2rem;
    color: var(--secondary);
}

.scoreboard-table .score.negative {
    color: var(--primary);
}

.scoreboard-actions {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-top: 30px;
}

/* ---------- SETTINGS SCREEN ---------- */
.settings-container {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 25px;
    max-width: 500px;
    width: 100%;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(20px);
}

.settings-section {
    margin-bottom: 35px;
    text-align: left;
}

.settings-section h2 {
    color: var(--primary);
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    gap: 12px;
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 15px;
    margin-bottom: 15px;
    transition: var(--transition);
}

.setting-item:hover {
    background: rgba(0, 0, 0, 0.3);
    transform: translateX(5px);
}

.setting-item label {
    font-weight: 600;
    color: var(--light);
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 1.1rem;
}

/* Toggle Switch */
.switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: var(--transition);
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 22px;
    width: 22px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: var(--transition);
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--primary);
}

input:checked + .slider:before {
    transform: translateX(30px);
}

/* Range Slider */
.range-slider {
    width: 150px;
    height: 30px;
    -webkit-appearance: none;
    appearance: none;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    border-radius: 15px;
    outline: none;
}

.range-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: var(--light);
    cursor: pointer;
    border: 3px solid var(--primary);
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

/* ---------- SOUND CONTROLS ---------- */
.sound-controls {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 2000;
}

.sound-btn {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    border: none;
    background: var(--nav-bg);
    backdrop-filter: blur(20px);
    color: var(--light);
    font-size: 1.8rem;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    border: 2px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
}

.sound-btn:hover {
    transform: scale(1.1) rotate(15deg);
    background: color-mix(in srgb, var(--primary) 30%, var(--nav-bg));
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
}

.sound-btn.muted {
    color: var(--gray);
    transform: scale(0.9);
}

/* ---------- NOTIFICATIONS ---------- */
.notification {
    position: fixed;
    top: 100px;
    left: 50%;
    transform: translateX(-50%);
    padding: 20px 30px;
    border-radius: 15px;
    background: var(--card-bg);
    color: var(--light);
    z-index: 2000;
    font-weight: bold;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    border-left: 5px solid var(--primary);
    backdrop-filter: blur(20px);
    animation: slideDown 0.3s ease, fadeOut 0.3s ease 2.7s;
    max-width: 90%;
    text-align: center;
}

@keyframes slideDown {
    from { opacity: 0; transform: translate(-50%, -30px); }
    to { opacity: 1; transform: translate(-50%, 0); }
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

/* ---------- RESPONSIVE ---------- */
@media (max-width: 600px) {
    .logo { font-size: 2.5rem; }
    .panic-timer { font-size: 4.5rem; }
    .stop-title { font-size: 3.5rem; }
    .challenge-text { font-size: 1.7rem; padding: 20px; }
    .scoreboard-title { font-size: 2.2rem; }
    .game-mode-selector { grid-template-columns: 1fr; }
    .theme-selector { grid-template-columns: repeat(2, 1fr); }
    .nav-item span { display: none; }
    .nav-item i { font-size: 1.8rem; margin-bottom: 0; }
    .btn { padding: 16px 20px; font-size: 1rem; }
    .setting-item { flex-direction: column; align-items: flex-start; gap: 15px; }
    .setting-item > div { align-self: flex-end; }
}

@media (max-width: 400px) {
    .logo { font-size: 2rem; }
    .panic-timer { font-size: 3.5rem; }
    .stop-title { font-size: 2.8rem; }
    .current-player-display { font-size: 1.5rem; padding: 20px; }
    .challenge-text { font-size: 1.5rem; }
    .screen { padding: 70px 15px 70px; }
}
</style>
</head>

<body class="theme-neon">

<div class="background-animation" id="backgroundAnimation"></div>
<div class="particles-container" id="particles"></div>

<!-- TOP HEADER -->
<div class="game-header">
    <div class="header-left">
        <div class="header-title" id="headerTitle">PASS & PANIC</div>
    </div>
    <div class="header-right">
        <div class="stat-box" id="roundStat">Round 1</div>
        <div class="stat-box" id="playersStat">0 Players</div>
    </div>
</div>

<!-- NAVIGATION BAR -->
<div class="nav-bar">
    <button class="nav-item active" onclick="navigateTo('home')">
        <i class="fas fa-home"></i>
        <span>Home</span>
    </button>
    <button class="nav-item" onclick="navigateTo('setup')">
        <i class="fas fa-play-circle"></i>
        <span>Play</span>
    </button>
    <button class="nav-item" onclick="navigateTo('scoreboard')">
        <i class="fas fa-trophy"></i>
        <span>Scores</span>
    </button>
    <button class="nav-item" onclick="navigateTo('settings')">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
    </button>
</div>

<!-- HOME SCREEN -->
<div id="home" class="screen active">
    <div class="logo">‚ö† PASS & PANIC ‚ö†</div>
    <p class="tagline">Pass the phone fast or face the challenge! The timer stops randomly - don't get caught holding the phone when it does!</p>
    
    <div class="quick-stats">
        <div class="stat-card">
            <h3>Current Round</h3>
            <div class="value" id="homeRound">1</div>
        </div>
        <div class="stat-card">
            <h3>Active Players</h3>
            <div class="value" id="homePlayers">0</div>
        </div>
        <div class="stat-card">
            <h3>High Score</h3>
            <div class="value" id="homeHighScore">0</div>
        </div>
        <div class="stat-card">
            <h3>Games Played</h3>
            <div class="value" id="homeGames">0</div>
        </div>
    </div>
    
    <button class="btn btn-primary" onclick="navigateTo('setup')">
        <i class="fas fa-play-circle"></i> QUICK PLAY
    </button>
    <button class="btn btn-info" onclick="navigateTo('scoreboard')">
        <i class="fas fa-trophy"></i> LEADERBOARD
    </button>
    <button class="btn btn-warning" onclick="showInstructions()">
        <i class="fas fa-question-circle"></i> HOW TO PLAY
    </button>
</div>

<!-- SETUP SCREEN -->
<div id="setup" class="screen">
    <div class="setup-container">
        <h2><i class="fas fa-gamepad"></i> Game Setup</h2>
        
        <!-- Game Mode Selector -->
        <div class="setup-section">
            <h3><i class="fas fa-chess"></i> Game Mode</h3>
            <div class="game-mode-selector" id="gameModeSelector">
                <button class="mode-btn" data-mode="classic" onclick="setGameMode('classic')">
                    <i class="fas fa-users"></i>
                    Classic
                </button>
                <button class="mode-btn" data-mode="knockout" onclick="setGameMode('knockout')">
                    <i class="fas fa-skull-crossbones"></i>
                    Knockout
                </button>
                <button class="mode-btn" data-mode="team" onclick="setGameMode('team')">
                    <i class="fas fa-people-group"></i>
                    Team
                </button>
                <button class="mode-btn" data-mode="kids" onclick="setGameMode('kids')">
                    <i class="fas fa-child"></i>
                    Kids
                </button>
                <button class="mode-btn" data-mode="party" onclick="setGameMode('party')">
                    <i class="fas fa-glass-cheers"></i>
                    Party
                </button>
                <button class="mode-btn" data-mode="extreme" onclick="setGameMode('extreme')">
                    <i class="fas fa-fire"></i>
                    Extreme
                </button>
            </div>
        </div>
        
        <!-- Theme Selector -->
        <div class="setup-section">
            <h3><i class="fas fa-palette"></i> Theme</h3>
            <div class="theme-selector" id="themeSelector">
                <button class="theme-btn active" data-theme="neon" onclick="setTheme('neon')">
                    <i class="fas fa-bolt"></i>
                    Neon
                </button>
                <button class="theme-btn" data-theme="dark" onclick="setTheme('dark')">
                    <i class="fas fa-moon"></i>
                    Dark
                </button>
                <button class="theme-btn" data-theme="party" onclick="setTheme('party')">
                    <i class="fas fa-party-horn"></i>
                    Party
                </button>
                <button class="theme-btn" data-theme="horror" onclick="setTheme('horror')">
                    <i class="fas fa-ghost"></i>
                    Horror
                </button>
            </div>
        </div>
        
        <!-- Player Setup -->
        <div class="setup-section">
            <h3><i class="fas fa-users"></i> Players</h3>
            <p>Add 2-20 players to start</p>
            
            <div class="player-input-group">
                <input id="playerNameInput" placeholder="Enter player name" maxlength="15" onkeypress="handlePlayerInputKeypress(event)">
                <button class="btn btn-success" onclick="addPlayer()" style="max-width: 100px;">
                    <i class="fas fa-plus"></i> ADD
                </button>
            </div>
            
            <div class="players-list-container">
                <div class="players-list" id="playersList">
                    <div class="no-players">No players added yet</div>
                </div>
            </div>
            
            <div class="player-count" id="playerCount">Players: 0/20</div>
        </div>
        
        <button class="btn btn-primary" id="startGameBtn" onclick="startGame()" disabled>
            <i class="fas fa-rocket"></i> START GAME
        </button>
        <button class="btn btn-info" onclick="navigateTo('home')">
            <i class="fas fa-arrow-left"></i> BACK
        </button>
    </div>
</div>

<!-- PANIC SCREEN -->
<div id="panic" class="screen">
    <div class="panic-container">
        <h2 class="panic-title">PASS FAST!</h2>
        <div class="current-player-display" id="currentPlayerDisplay">Player 1</div>
        
        <div class="panic-timer" id="panicTimer">05</div>
        
        <div class="progress-container">
            <div class="progress-label">
                <span>TIME LEFT</span>
                <span id="timePercent">100%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="panicProgress"></div>
            </div>
        </div>
        
        <p class="pass-instruction">Pass the phone to the next player quickly!</p>
        
        <button class="btn btn-danger" onclick="skipPlayer()">
            <i class="fas fa-forward"></i> SKIP PLAYER
        </button>
        <button class="btn btn-warning" onclick="navigateTo('scoreboard')">
            <i class="fas fa-trophy"></i> SCORES
        </button>
    </div>
</div>

<!-- STOP SCREEN -->
<div id="stop" class="screen">
    <div class="stop-container">
        <div class="stop-title">STOP!</div>
        <div class="caught-player" id="caughtPlayer">
            <span id="caughtPlayerName">Player</span> GOT CAUGHT!
        </div>
        
        <p>Choose a challenge type:</p>
        
        <div class="challenge-selector">
            <button class="btn-challenge truth" onclick="chooseChallenge('truth')">
                <i class="fas fa-comment-dots"></i> TRUTH
            </button>
            <button class="btn-challenge dare" onclick="chooseChallenge('dare')">
                <i class="fas fa-running"></i> DARE
            </button>
            <button class="btn-challenge random" onclick="chooseChallenge('random')">
                <i class="fas fa-random"></i> RANDOM
            </button>
        </div>
        
        <button class="btn btn-info" onclick="skipChallenge()" style="margin-top: 20px;">
            <i class="fas fa-forward"></i> SKIP CHALLENGE
        </button>
    </div>
</div>

<!-- RESULT SCREEN -->
<div id="result" class="screen">
    <div class="result-container">
        <div class="challenge-type" id="challengeType">CHALLENGE</div>
        <div class="challenge-text" id="challengeText">Your challenge will appear here</div>
        
        <div class="excuse-text" id="excuseText">No excuses! Complete your challenge.</div>
        
        <button class="btn btn-success" onclick="completeChallenge()">
            <i class="fas fa-check-circle"></i> CHALLENGE COMPLETE
        </button>
        <button class="btn btn-warning" onclick="nextRound()">
            <i class="fas fa-redo-alt"></i> SKIP & NEXT ROUND
        </button>
        <button class="btn btn-info" onclick="navigateTo('scoreboard')">
            <i class="fas fa-trophy"></i> VIEW SCORES
        </button>
    </div>
</div>

<!-- SCOREBOARD SCREEN -->
<div id="scoreboard" class="screen">
    <div class="scoreboard-container">
        <div class="scoreboard-title">üèÜ LEADERBOARD</div>
        
        <div class="scoreboard-table-container">
            <table class="scoreboard-table" id="scoreboardTable">
                <thead>
                    <tr>
                        <th class="rank">#</th>
                        <th class="player-name">PLAYER</th>
                        <th class="score">SCORE</th>
                    </tr>
                </thead>
                <tbody id="scoreboardBody">
                    <!-- Scores will be populated here -->
                </tbody>
            </table>
        </div>
        
        <div class="scoreboard-actions">
            <button class="btn btn-success" onclick="resetScores()">
                <i class="fas fa-redo"></i> RESET SCORES
            </button>
            <button class="btn btn-info" onclick="navigateTo('setup')">
                <i class="fas fa-users"></i> ADD PLAYERS
            </button>
            <button class="btn btn-primary" onclick="continueGame()">
                <i class="fas fa-play"></i> CONTINUE GAME
            </button>
            <button class="btn btn-warning" onclick="navigateTo('home')">
                <i class="fas fa-home"></i> HOME
            </button>
        </div>
    </div>
</div>

<!-- SETTINGS SCREEN -->
<div id="settings" class="screen">
    <div class="settings-container">
        <h2><i class="fas fa-cog"></i> Settings</h2>
        
        <!-- Game Settings -->
        <div class="settings-section">
            <h3><i class="fas fa-gamepad"></i> Game Settings</h3>
            
            <div class="setting-item">
                <label><i class="fas fa-volume-up"></i> Sound Effects</label>
                <label class="switch">
                    <input type="checkbox" id="soundToggle" checked onchange="toggleSoundSetting()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <label><i class="fas fa-vibrate"></i> Haptic Feedback</label>
                <label class="switch">
                    <input type="checkbox" id="hapticToggle" checked onchange="toggleHapticSetting()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <label><i class="fas fa-save"></i> Auto-Save</label>
                <label class="switch">
                    <input type="checkbox" id="autosaveToggle" checked onchange="toggleAutosaveSetting()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <label><i class="fas fa-tachometer-alt"></i> Game Speed</label>
                <input type="range" min="1" max="10" value="5" class="range-slider" id="gameSpeed" onchange="updateGameSpeed()">
            </div>
        </div>
        
        <!-- Display Settings -->
        <div class="settings-section">
            <h3><i class="fas fa-display"></i> Display</h3>
            
            <div class="setting-item">
                <label><i class="fas fa-sun"></i> Dark Mode</label>
                <label class="switch">
                    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-item">
                <label><i class="fas fa-expand-alt"></i> Fullscreen Animations</label>
                <label class="switch">
                    <input type="checkbox" id="animationsToggle" checked onchange="toggleAnimations()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <!-- Data Management -->
        <div class="settings-section">
            <h3><i class="fas fa-database"></i> Data</h3>
            
            <button class="btn btn-warning" onclick="exportGameData()">
                <i class="fas fa-download"></i> EXPORT DATA
            </button>
            
            <button class="btn btn-danger" onclick="clearAllData()">
                <i class="fas fa-trash"></i> CLEAR ALL DATA
            </button>
            
            <button class="btn btn-info" onclick="showAbout()">
                <i class="fas fa-info-circle"></i> ABOUT
            </button>
        </div>
        
        <button class="btn btn-primary" onclick="navigateTo('home')">
            <i class="fas fa-check"></i> SAVE & CLOSE
        </button>
    </div>
</div>

<!-- SOUND BUTTON -->
<div class="sound-controls">
    <button class="sound-btn" id="soundBtn" onclick="toggleSound()">
        <i class="fas fa-volume-up"></i>
    </button>
</div>

<script>
// Enhanced Game State
const gameState = {
    players: [],
    scores: {},
    currentPlayerIndex: 0,
    round: 1,
    sound: true,
    haptic: true,
    autosave: true,
    theme: 'neon',
    gameMode: 'classic',
    gameSpeed: 5,
    timer: null,
    panicTimerInterval: null,
    panicTimeLeft: 0,
    panicTotalTime: 0,
    challengeType: 'random',
    maxPlayers: 20,
    gameHistory: [],
    stats: {
        gamesPlayed: 0,
        totalChallenges: 0,
        longestGame: 0
    }
};

// Enhanced Game Modes Configuration
const gameModes = {
    classic: {
        name: "Classic",
        icon: "users",
        description: "Standard Pass & Panic rules",
        timerMin: 3000,
        timerMax: 8000,
        challengePoints: 2,
        penaltyPoints: -1
    },
    knockout: {
        name: "Knockout",
        icon: "skull-crossbones",
        description: "Eliminate players who fail challenges",
        timerMin: 2000,
        timerMax: 6000,
        challengePoints: 3,
        penaltyPoints: -2,
        elimination: true
    },
    team: {
        name: "Team",
        icon: "people-group",
        description: "Play in teams, score together",
        timerMin: 4000,
        timerMax: 10000,
        challengePoints: 2,
        penaltyPoints: -1,
        teamBased: true
    },
    kids: {
        name: "Kids",
        icon: "child",
        description: "Family-friendly challenges",
        timerMin: 5000,
        timerMax: 15000,
        challengePoints: 1,
        penaltyPoints: 0,
        kidFriendly: true
    },
    party: {
        name: "Party",
        icon: "glass-cheers",
        description: "Wild challenges and party games",
        timerMin: 2000,
        timerMax: 5000,
        challengePoints: 3,
        penaltyPoints: -1,
        partyMode: true
    },
    extreme: {
        name: "Extreme",
        icon: "fire",
        description: "Hardcore challenges, fast timer",
        timerMin: 1000,
        timerMax: 3000,
        challengePoints: 5,
        penaltyPoints: -3,
        extreme: true
    }
};

// Enhanced Challenges Database
const challenges = {
    truth: [
        "What's the most embarrassing thing you've ever done?",
        "If you could swap lives with someone for a day, who would it be?",
        "What's a secret you've never told anyone?",
        "What's your biggest fear?",
        "What's the worst lie you've ever told?",
        "What's the most childish thing you still do?",
        "What's your most irrational fear?",
        "What's the most trouble you've ever been in?",
        "What's something you're glad your parents never found out about?",
        "If you had to delete one app from your phone, which would it be and why?"
    ],
    dare: [
        "Do your best impression of a famous person until someone guesses who you are",
        "Let the group give you a new hairstyle using whatever they can find",
        "Do 20 squats right now",
        "Sing a popular song in an opera style",
        "Let someone draw a mustache on your face with a pen",
        "Do a silly dance for 30 seconds",
        "Speak in an accent for the next 3 rounds",
        "Post a silly selfie on your social media",
        "Call a friend and sing 'Happy Birthday' to them (even if it's not their birthday)",
        "Balance a spoon on your nose for 30 seconds"
    ],
    random: [
        "Say the alphabet backwards in under 30 seconds",
        "Make up a rap about the person to your left",
        "Act out a movie scene without speaking until someone guesses the movie",
        "Let everyone give you a nickname that sticks for the rest of the game",
        "Try to lick your elbow (we know you can't!)",
        "Hold a plank for 60 seconds",
        "Tell a story where each person adds one word",
        "Imitate each player until someone guesses who you're imitating",
        "Create a 30-second commercial for a random object in the room",
        "Speak in rhymes for the next 2 rounds"
    ],
    kids: [
        "Make your best animal noise",
        "Do 10 jumping jacks",
        "Tell us your favorite joke",
        "Dance like a robot for 30 seconds",
        "Give everyone a high-five",
        "Say the alphabet as fast as you can",
        "Make a funny face and keep it until someone laughs",
        "Hop on one foot while counting to 20",
        "Tell us what you want to be when you grow up",
        "Give a compliment to everyone playing"
    ],
    party: [
        "Take a shot (or sip of your drink)",
        "Do your best twerk for 10 seconds",
        "Let someone post whatever they want on your social media",
        "Do a body shot off someone's belly",
        "Kiss the person to your right on the cheek",
        "Take off one item of clothing",
        "Let the group choose your next profile picture",
        "Drink from your shoe (clean it first!)",
        "Swap an item of clothing with someone",
        "Do a lap dance for the person of your choice"
    ],
    extreme: [
        "Call your ex and say you miss them",
        "Text your boss 'I quit' (then quickly say it's a game)",
        "Post an embarrassing childhood photo",
        "Eat a spoonful of a weird food combination",
        "Let someone shave a small part of your body",
        "Run outside and scream 'I love you' to the first person you see",
        "Drink a mystery shot the group prepares",
        "Let the group give you a temporary tattoo anywhere",
        "Wear your clothes backwards for the rest of the game",
        "Call a random number and sing a love song"
    ]
};

// Initialize particles with theme colors
function initParticles() {
    const container = document.getElementById('particles');
    container.innerHTML = '';
    const particleCount = window.innerWidth < 600 ? 30 : 50;
    
    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        const size = Math.random() * 8 + 3;
        const posX = Math.random() * 100;
        const delay = Math.random() * 15;
        const duration = Math.random() * 10 + 15;
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}%`;
        particle.style.animationDelay = `${delay}s`;
        particle.style.animationDuration = `${duration}s`;
        particle.style.opacity = Math.random() * 0.5 + 0.1;
        particle.style.background = getComputedStyle(document.documentElement).getPropertyValue('--primary');
        
        container.appendChild(particle);
    }
}

// Update background based on theme
function updateBackground() {
    const bg = document.getElementById('backgroundAnimation');
    const root = document.documentElement;
    
    switch(gameState.theme) {
        case 'neon':
            bg.style.background = `
                radial-gradient(circle at 20% 30%, rgba(255, 0, 51, 0.15), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 255, 136, 0.1), transparent 40%),
                radial-gradient(circle at 40% 80%, rgba(170, 0, 255, 0.1), transparent 40%),
                linear-gradient(135deg, var(--darker), #111122)
            `;
            break;
        case 'dark':
            bg.style.background = `
                radial-gradient(circle at 20% 30%, rgba(52, 152, 219, 0.1), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(46, 204, 113, 0.1), transparent 40%),
                linear-gradient(135deg, var(--darker), #1a1a2e)
            `;
            break;
        case 'party':
            bg.style.background = `
                radial-gradient(circle at 20% 30%, rgba(255, 0, 102, 0.2), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 255, 204, 0.15), transparent 40%),
                radial-gradient(circle at 40% 80%, rgba(255, 204, 0, 0.15), transparent 40%),
                linear-gradient(135deg, var(--darker), #330044)
            `;
            break;
        case 'horror':
            bg.style.background = `
                radial-gradient(circle at 20% 30%, rgba(255, 51, 0, 0.15), transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(51, 255, 0, 0.1), transparent 40%),
                linear-gradient(135deg, var(--darker), #220000)
            `;
            break;
    }
    
    initParticles();
}

// Load game state from localStorage
function loadGameState() {
    try {
        const savedState = localStorage.getItem('passAndPanicEnhanced');
        if (savedState) {
            const parsed = JSON.parse(savedState);
            
            if (parsed.players && parsed.players.length > 0) {
                gameState.players = parsed.players;
                gameState.scores = parsed.scores || {};
                gameState.round = parsed.round || 1;
                gameState.sound = parsed.sound !== undefined ? parsed.sound : true;
                gameState.haptic = parsed.haptic !== undefined ? parsed.haptic : true;
                gameState.autosave = parsed.autosave !== undefined ? parsed.autosave : true;
                gameState.theme = parsed.theme || 'neon';
                gameState.gameMode = parsed.gameMode || 'classic';
                gameState.gameSpeed = parsed.gameSpeed || 5;
                gameState.stats = parsed.stats || gameState.stats;
                
                gameState.players.forEach(player => {
                    if (!gameState.scores[player]) {
                        gameState.scores[player] = 0;
                    }
                });
                
                console.log('Game state loaded');
                return true;
            }
        }
    } catch (e) {
        console.error('Error loading game state:', e);
    }
    return false;
}

// Save game state to localStorage
function saveGameState() {
    if (!gameState.autosave) return;
    
    try {
        const stateToSave = {
            players: gameState.players,
            scores: gameState.scores,
            round: gameState.round,
            sound: gameState.sound,
            haptic: gameState.haptic,
            autosave: gameState.autosave,
            theme: gameState.theme,
            gameMode: gameState.gameMode,
            gameSpeed: gameState.gameSpeed,
            stats: gameState.stats,
            timestamp: Date.now()
        };
        localStorage.setItem('passAndPanicEnhanced', JSON.stringify(stateToSave));
    } catch (e) {
        console.error('Error saving game state:', e);
    }
}

// Navigation system
function navigateTo(screenId) {
    // Update navigation active state
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    document.querySelector(`.nav-item[onclick*="${screenId}"]`)?.classList.add('active');
    
    // Update header title
    const titles = {
        home: 'PASS & PANIC',
        setup: 'GAME SETUP',
        panic: 'PASS FAST!',
        stop: 'STOP!',
        result: 'CHALLENGE',
        scoreboard: 'LEADERBOARD',
        settings: 'SETTINGS'
    };
    document.getElementById('headerTitle').textContent = titles[screenId] || 'PASS & PANIC';
    
    // Hide all screens
    document.querySelectorAll('.screen').forEach(s => {
        s.classList.remove('active');
    });
    
    // Show target screen
    document.getElementById(screenId).classList.add('active');
    
    // Update stats if going home
    if (screenId === 'home') {
        updateHomeStats();
    }
    
    // Update scoreboard if needed
    if (screenId === 'scoreboard') {
        updateScoreboard();
    }
    
    // Play sound
    playSound('click');
}

// Set game mode
function setGameMode(mode) {
    gameState.gameMode = mode;
    
    // Update UI
    document.querySelectorAll('.mode-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`.mode-btn[data-mode="${mode}"]`).classList.add('active');
    
    showNotification(`Game mode set to: ${gameModes[mode].name}`);
    saveGameState();
}

// Set theme
function setTheme(theme) {
    gameState.theme = theme;
    
    // Update body class
    document.body.className = `theme-${theme}`;
    
    // Update UI
    document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelector(`.theme-btn[data-theme="${theme}"]`).classList.add('active');
    
    // Update background
    updateBackground();
    
    showNotification(`Theme changed to: ${theme}`);
    saveGameState();
}

// Update home screen stats
function updateHomeStats() {
    document.getElementById('homeRound').textContent = gameState.round;
    document.getElementById('homePlayers').textContent = gameState.players.length;
    
    // Calculate high score
    const highScore = Math.max(...Object.values(gameState.scores), 0);
    document.getElementById('homeHighScore').textContent = highScore;
    
    document.getElementById('homeGames').textContent = gameState.stats.gamesPlayed || 0;
}

// Show notification
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    
    // Set color based on type
    if (type === 'error') {
        notification.style.borderLeftColor = getComputedStyle(document.documentElement).getPropertyValue('--primary');
    } else if (type === 'success') {
        notification.style.borderLeftColor = getComputedStyle(document.documentElement).getPropertyValue('--secondary');
    }
    
    document.body.appendChild(notification);
    
    // Remove after animation
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// Initialize the game
function initGame() {
    // Load saved state
    const loaded = loadGameState();
    
    // Initialize UI
    updateBackground();
    renderPlayers();
    updateHomeStats();
    
    // Initialize settings toggles
    document.getElementById('soundToggle').checked = gameState.sound;
    document.getElementById('hapticToggle').checked = gameState.haptic;
    document.getElementById('autosaveToggle').checked = gameState.autosave;
    document.getElementById('gameSpeed').value = gameState.gameSpeed;
    
    // Set active game mode and theme
    setTimeout(() => {
        document.querySelector(`.mode-btn[data-mode="${gameState.gameMode}"]`)?.classList.add('active');
        document.querySelector(`.theme-btn[data-theme="${gameState.theme}"]`)?.classList.add('active');
    }, 100);
    
    if (loaded && gameState.players.length > 0) {
        showNotification('Game loaded successfully!', 'success');
    }
    
    // Prevent pull-to-refresh on mobile
    document.body.addEventListener('touchmove', function(e) {
        if (e.touches.length > 1) return;
        e.preventDefault();
    }, { passive: false });
    
    console.log('Enhanced Pass & Panic loaded!');
}

// Initialize when page loads
window.addEventListener('DOMContentLoaded', initGame);

// Auto-save on unload
window.addEventListener('beforeunload', saveGameState);

// Keep existing game functions but update them to use navigation
function showScreen(id) {
    navigateTo(id);
}

function showInstructions() {
    alert(`üéÆ ULTIMATE PASS & PANIC üéÆ

üåü GAME MODES:
‚Ä¢ Classic: Standard Pass & Panic rules
‚Ä¢ Knockout: Players get eliminated when they fail challenges
‚Ä¢ Team: Play in teams, score together
‚Ä¢ Kids: Family-friendly challenges
‚Ä¢ Party: Wild party challenges
‚Ä¢ Extreme: Hardcore mode for daredevils

üé® THEMES:
‚Ä¢ Neon: Bright neon colors
‚Ä¢ Dark: Dark mode for night play
‚Ä¢ Party: Colorful party theme
‚Ä¢ Horror: Spooky Halloween theme

üì± FEATURES:
‚Ä¢ Up to 20 players
‚Ä¢ 4 unique themes
‚Ä¢ 6 game modes
‚Ä¢ Scoreboard tracking
‚Ä¢ Haptic feedback
‚Ä¢ Auto-save
‚Ä¢ Customizable settings

üéØ HOW TO PLAY:
1. Add players (2-20)
2. Choose game mode and theme
3. Start game - phone passes with random timer
4. When timer stops, player holding phone gets a challenge
5. Complete challenge to earn points
6. Check leaderboard to see who's winning!

TIP: The timer speed changes based on game mode!`);
}

// Add player function (updated)
function addPlayer() {
    const input = document.getElementById('playerNameInput');
    const name = input.value.trim();
    
    if (!name) {
        showNotification('Please enter a player name!', 'error');
        return;
    }
    
    if (gameState.players.includes(name)) {
        showNotification('Player already added!', 'error');
        return;
    }
    
    if (gameState.players.length >= gameState.maxPlayers) {
        showNotification(`Maximum ${gameState.maxPlayers} players allowed!`, 'error');
        return;
    }
    
    gameState.players.push(name);
    gameState.scores[name] = gameState.scores[name] || 0;
    input.value = '';
    input.focus();
    
    renderPlayers();
    playSound('add');
    saveGameState();
}

// Render players list
function renderPlayers() {
    const list = document.getElementById('playersList');
    const playerCount = document.getElementById('playerCount');
    
    list.innerHTML = '';
    
    if (gameState.players.length === 0) {
        list.innerHTML = '<div class="no-players">No players added yet</div>';
    } else {
        gameState.players.forEach((player, index) => {
            const playerTag = document.createElement('div');
            playerTag.className = 'player-tag';
            playerTag.innerHTML = `
                <span>${player}</span>
                <button class="remove-player" onclick="removePlayer(${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
            list.appendChild(playerTag);
        });
    }
    
    // Update player count
    const countText = `Players: ${gameState.players.length}/${gameState.maxPlayers}`;
    playerCount.textContent = countText;
    
    if (gameState.players.length >= gameState.maxPlayers - 2) {
        playerCount.classList.add('warning');
    } else {
        playerCount.classList.remove('warning');
    }
    
    document.getElementById('startGameBtn').disabled = gameState.players.length < 2;
    updateStats();
}

// Remove player
function removePlayer(index) {
    const name = gameState.players[index];
    gameState.players.splice(index, 1);
    delete gameState.scores[name];
    
    if (gameState.currentPlayerIndex >= gameState.players.length) {
        gameState.currentPlayerIndex = 0;
    }
    
    renderPlayers();
    playSound('remove');
    saveGameState();
}

// Start game with current mode
function startGame() {
    if (gameState.players.length < 2) {
        showNotification('Need at least 2 players to start!', 'error');
        return;
    }
    
    gameState.currentPlayerIndex = 0;
    gameState.round = 1;
    gameState.stats.gamesPlayed = (gameState.stats.gamesPlayed || 0) + 1;
    
    navigateTo('panic');
    startPanicTimer();
    playSound('start');
    saveGameState();
}

// Start panic timer based on game mode
function startPanicTimer() {
    if (gameState.panicTimerInterval) {
        clearInterval(gameState.panicTimerInterval);
    }
    
    const mode = gameModes[gameState.gameMode];
    const speedMultiplier = 1 / (gameState.gameSpeed / 5);
    
    let minTime = mode.timerMin * speedMultiplier;
    let maxTime = mode.timerMax * speedMultiplier;
    
    gameState.panicTotalTime = Math.floor(Math.random() * (maxTime - minTime)) + minTime;
    gameState.panicTimeLeft = gameState.panicTotalTime;
    
    document.getElementById('currentPlayerDisplay').innerText = 
        `${gameState.players[gameState.currentPlayerIndex]} has the phone!`;
    
    gameState.panicTimerInterval = setInterval(() => {
        gameState.panicTimeLeft -= 50;
        
        const seconds = Math.ceil(gameState.panicTimeLeft / 1000);
        document.getElementById('panicTimer').innerText = seconds > 0 ? seconds : 0;
        
        const percent = (gameState.panicTimeLeft / gameState.panicTotalTime) * 100;
        document.getElementById('panicProgress').style.width = `${percent}%`;
        document.getElementById('timePercent').innerText = `${Math.floor(percent)}%`;
        
        // Update progress bar color
        if (percent < 30) {
            document.getElementById('panicProgress').style.background = 
                `linear-gradient(90deg, var(--primary), var(--warning))`;
            
            // Haptic feedback for last 2 seconds
            if (gameState.haptic && gameState.panicTimeLeft < 2000 && gameState.panicTimeLeft % 500 < 50) {
                triggerHapticFeedback();
            }
        } else if (percent < 60) {
            document.getElementById('panicProgress').style.background = 
                `linear-gradient(90deg, var(--warning), var(--secondary))`;
        }
        
        if (gameState.panicTimeLeft <= 0) {
            clearInterval(gameState.panicTimerInterval);
            stopGame();
        }
        
        updateHeaderTimer();
    }, 50);
    
    updateHeaderTimer();
}

// Update header timer
function updateHeaderTimer() {
    const timerElement = document.getElementById('timerStat');
    let seconds = Math.ceil(gameState.panicTimeLeft / 1000);
    
    if (seconds < 0) seconds = 0;
    
    timerElement.innerText = `${seconds}s`;
    
    if (seconds < 3) {
        timerElement.style.color = getComputedStyle(document.documentElement).getPropertyValue('--primary');
    } else {
        timerElement.style.color = '';
    }
}

// Update stats
function updateStats() {
    document.getElementById('roundStat').innerText = `Round: ${gameState.round}`;
    document.getElementById('playersStat').innerText = `${gameState.players.length} Players`;
}

// Stop game when timer runs out
function stopGame() {
    clearInterval(gameState.panicTimerInterval);
    
    const caughtPlayer = gameState.players[gameState.currentPlayerIndex];
    document.getElementById('caughtPlayerName').innerText = caughtPlayer;
    
    // Apply penalty based on game mode
    const mode = gameModes[gameState.gameMode];
    gameState.scores[caughtPlayer] += mode.penaltyPoints;
    
    gameState.gameHistory.push({
        player: caughtPlayer,
        action: 'caught',
        round: gameState.round,
        mode: gameState.gameMode,
        timestamp: Date.now()
    });
    
    navigateTo('stop');
    playSound('stop');
    if (gameState.haptic) triggerHapticFeedback();
    saveGameState();
}

// Choose challenge based on game mode
function chooseChallenge(type) {
    gameState.challengeType = type;
    
    let challengeList;
    const mode = gameModes[gameState.gameMode];
    
    // Select challenge list based on game mode
    if (mode.kidFriendly) {
        challengeList = challenges.kids;
    } else if (mode.partyMode) {
        challengeList = challenges.party;
    } else if (mode.extreme) {
        challengeList = challenges.extreme;
    } else {
        if (type === 'random') {
            challengeList = [
                ...challenges.truth,
                ...challenges.dare,
                ...challenges.random
            ];
        } else {
            challengeList = challenges[type];
        }
    }
    
    const randomChallenge = challengeList[Math.floor(Math.random() * challengeList.length)];
    
    document.getElementById('challengeType').innerText = type.toUpperCase();
    document.getElementById('challengeType').className = `challenge-type ${type}`;
    document.getElementById('challengeText').innerText = randomChallenge;
    
    const excuses = [
        "No excuses! Complete your challenge.",
        "You've got this! Show us what you're made of.",
        "The group is watching... no pressure!",
        "Remember, it's all in good fun!",
        "Do your best and have fun with it!"
    ];
    document.getElementById('excuseText').innerText = excuses[Math.floor(Math.random() * excuses.length)];
    
    navigateTo('result');
    playSound('challenge');
    if (gameState.haptic) triggerHapticFeedback();
    saveGameState();
}

// Complete challenge
function completeChallenge() {
    const player = gameState.players[gameState.currentPlayerIndex];
    const mode = gameModes[gameState.gameMode];
    
    gameState.scores[player] += mode.challengePoints;
    gameState.stats.totalChallenges = (gameState.stats.totalChallenges || 0) + 1;
    
    gameState.gameHistory.push({
        player: player,
        action: 'completed_challenge',
        challengeType: gameState.challengeType,
        round: gameState.round,
        mode: gameState.gameMode,
        timestamp: Date.now()
    });
    
    showNotification(`${player} completed the challenge! +${mode.challengePoints} points`, 'success');
    nextRound();
}

// Next round
function nextRound() {
    gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
    gameState.round++;
    
    navigateTo('panic');
    startPanicTimer();
    playSound('next');
    saveGameState();
}

// Skip player
function skipPlayer() {
    gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
    document.getElementById('currentPlayerDisplay').innerText = 
        `${gameState.players[gameState.currentPlayerIndex]} has the phone!`;
    playSound('skip');
}

// Skip challenge
function skipChallenge() {
    gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;
    gameState.round++;
    navigateTo('panic');
    startPanicTimer();
    playSound('skip');
    saveGameState();
}

// Continue game from scoreboard
function continueGame() {
    if (gameState.players.length < 2) {
        showNotification('Need at least 2 players to continue!', 'error');
        navigateTo('setup');
        return;
    }
    
    navigateTo('panic');
    startPanicTimer();
}

// Update scoreboard
function updateScoreboard() {
    const tbody = document.getElementById('scoreboardBody');
    tbody.innerHTML = '';
    
    if (gameState.players.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="3" style="text-align: center; padding: 40px; color: var(--gray);">
                    No players yet. Add players in the setup screen!
                </td>
            </tr>
        `;
        return;
    }
    
    const sortedPlayers = [...gameState.players].sort((a, b) => {
        return gameState.scores[b] - gameState.scores[a];
    });
    
    sortedPlayers.forEach((player, index) => {
        const score = gameState.scores[player] || 0;
        const row = document.createElement('tr');
        
        let rankEmoji = '';
        if (index === 0) rankEmoji = 'ü•á';
        else if (index === 1) rankEmoji = 'ü•à';
        else if (index === 2) rankEmoji = 'ü•â';
        
        row.innerHTML = `
            <td class="rank">${index + 1} ${rankEmoji}</td>
            <td class="player-name">${player}</td>
            <td class="score ${score < 0 ? 'negative' : ''}">${score > 0 ? '+' : ''}${score}</td>
        `;
        tbody.appendChild(row);
    });
}

// Reset scores
function resetScores() {
    if (confirm('Are you sure you want to reset all scores to zero?')) {
        gameState.players.forEach(player => {
            gameState.scores[player] = 0;
        });
        updateScoreboard();
        saveGameState();
        showNotification('All scores have been reset!', 'success');
    }
}

// Settings functions
function toggleSoundSetting() {
    gameState.sound = document.getElementById('soundToggle').checked;
    const soundBtn = document.getElementById('soundBtn');
    
    if (gameState.sound) {
        soundBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
        soundBtn.classList.remove('muted');
        playSound('toggle');
    } else {
        soundBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
        soundBtn.classList.add('muted');
    }
    
    saveGameState();
}

function toggleHapticSetting() {
    gameState.haptic = document.getElementById('hapticToggle').checked;
    saveGameState();
}

function toggleAutosaveSetting() {
    gameState.autosave = document.getElementById('autosaveToggle').checked;
    saveGameState();
}

function updateGameSpeed() {
    gameState.gameSpeed = document.getElementById('gameSpeed').value;
    saveGameState();
}

function toggleDarkMode() {
    // This is handled by themes, but we keep it for compatibility
    const isDark = document.getElementById('darkModeToggle').checked;
    setTheme(isDark ? 'dark' : 'neon');
}

function toggleAnimations() {
    const enabled = document.getElementById('animationsToggle').checked;
    if (!enabled) {
        document.body.style.animation = 'none';
        document.querySelectorAll('*').forEach(el => {
            el.style.animation = 'none';
        });
    }
    saveGameState();
}

function exportGameData() {
    const data = {
        players: gameState.players,
        scores: gameState.scores,
        stats: gameState.stats,
        gameHistory: gameState.gameHistory,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    
    const exportFileDefaultName = `pass-and-panic-${Date.now()}.json`;
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
    
    showNotification('Game data exported successfully!', 'success');
}

function clearAllData() {
    if (confirm('This will delete ALL game data including scores and players. Are you sure?')) {
        localStorage.removeItem('passAndPanicEnhanced');
        gameState.players = [];
        gameState.scores = {};
        gameState.round = 1;
        gameState.gameHistory = [];
        gameState.stats = { gamesPlayed: 0, totalChallenges: 0, longestGame: 0 };
        
        renderPlayers();
        updateScoreboard();
        updateHomeStats();
        
        showNotification('All data has been cleared!', 'success');
    }
}

function showAbout() {
    alert(`ULTIMATE PASS & PANIC v2.0

An enhanced party game for Android and Web.

FEATURES:
‚Ä¢ 6 unique game modes
‚Ä¢ 4 customizable themes
‚Ä¢ Up to 20 players
‚Ä¢ Scoreboard tracking
‚Ä¢ Haptic feedback
‚Ä¢ Auto-save
‚Ä¢ Export/import data

CREDITS:
Developed with ‚ù§Ô∏è for party game lovers

¬© 2023 All rights reserved`);
}

// Sound and haptic functions
function toggleSound() {
    gameState.sound = !gameState.sound;
    const soundBtn = document.getElementById('soundBtn');
    
    if (gameState.sound) {
        soundBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
        soundBtn.classList.remove('muted');
        playSound('toggle');
    } else {
        soundBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
        soundBtn.classList.add('muted');
    }
    
    document.getElementById('soundToggle').checked = gameState.sound;
    saveGameState();
}

function triggerHapticFeedback() {
    if (gameState.haptic && navigator.vibrate) {
        try {
            navigator.vibrate(50);
        } catch (e) {
            // Silently fail
        }
    }
}

// Handle enter key in player input
function handlePlayerInputKeypress(event) {
    if (event.key === 'Enter') {
        addPlayer();
    }
}

// Keep existing playSound function from previous version
function playSound(type) {
    if (!gameState.sound) return;
    
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    let oscillator, gainNode;
    
    try {
        oscillator = audioContext.createOscillator();
        gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        switch(type) {
            case 'click':
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
                break;
                
            case 'add':
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.3);
                break;
                
            case 'remove':
                oscillator.frequency.setValueAtTime(392, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
                break;
                
            case 'start':
                [0, 0.1, 0.2].forEach((time, i) => {
                    oscillator.frequency.setValueAtTime([523.25, 659.25, 783.99][i], audioContext.currentTime + time);
                });
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
                break;
                
            case 'stop':
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
                break;
                
            case 'challenge':
                oscillator.frequency.setValueAtTime(329.63, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.4);
                break;
                
            case 'next':
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.2);
                break;
                
            case 'skip':
                oscillator.frequency.setValueAtTime(493.88, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.15);
                break;
                
            case 'toggle':
                oscillator.frequency.setValueAtTime(698.46, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
                break;
        }
    } catch (e) {
        console.log("Audio error:", e);
    }
}
</script>
</body>
</html>
